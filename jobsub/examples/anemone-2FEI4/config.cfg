# EXAMPLE CONFIG FOR RUNNING LOCALLY OVER TELESCOPE DATA ONLY
# - configuration for Datura telescope used for test beam campaign in June 2012 at DESY TB21
# - for details see the included README
# - for tests, you can find an example run here:
#   /afs/desy.de/group/telescopes/EutelTestData/TestPysubExampleDaturaAlone/run004118.raw
#   (telescope only data taken with (passive) CMS pixel as DUT)
# ---------------------------------------------------------------------------------------------
# 

[DEFAULT]
# global section. Settings can be overwritten through task-specific sections

# The python config parser interprets '%(NAME)s' as the corresponding variable NAME.
# The variable EutelescopePath is by default filled with the environment variable EUTELESCOPE
# and should correspond to the installation path of EUTelescope.
# Also, the variable %(home)s corresponds to the user's home directory.

# the template file name can be set with
# TemplateFile = file.xml
# The default is '[task]-tmp.xml'

BasePath     		= %(eutelescopepath)s/jobsub/examples/anemone-2FEI4
TemplatePath		= %(BasePath)s/steering-templates
# set the folder which contains the raw/native data files
# NativeFolder            = /afs/desy.de/group/telescopes/EutelTestData/TestExampleAnemone2FEI4
NativeFolder            = /home/ilcsoft/TestBeam/tests/anemone-2FEI4/native/

# geometry file
GearFile                = gear_desy2012_04_anemone_2FEI4.xml
# histogram information
Histoinfo   		= histoinfo.xml
# format for the output; @RunNumber@ is the current run number padded with leading zeros to 6 digits
Output			= run@RunNumber@
# which run number to use for hot pixel determination
HotpixelRunNumber	= @RunNumber@
SkipNEvents             = 
# set here the path where the gear file are stored
GearFilePath	        = %(TemplatePath)s
# set here the path for the histoinfo file
HistoinfoPath           = %(TemplatePath)s
# The XML file with histogram information
HistoInfoFile   	= %(TemplatePath)s/histoinfo.xml


# Set here the path for the input file
# recommended subfolder structure:
LocalFolderOutputBase   = ./output
LcioPath                = %(LocalFolderOutputBase)s/lcio
DBPath			= %(LocalFolderOutputBase)s/database
HistoPath		= %(LocalFolderOutputBase)s/histograms
LogPath			= %(LocalFolderOutputBase)s/logs
# limit processing of run to a certain number of events
MaxRecordNumber         = 10000
# the verbosity used by the eutelescope producers (i.e. MESSAGE, DEBUG, ERROR with appended level from 0..9, e.g. MESSAGE5)
# if you set this to DEBUG0 but you do not see any DEBUG messages, make sure that you set CMAKE_BUILD_TYPE to Debug in the 
# $EUTELESCOPE/CMakeList.txt file.
Verbosity               = MESSAGE4
MemCheckFlag            =

HotPixelDBFile          = %(DBPath)s/run@RunNumber@-hotpixel-db.slcio

RefHitDBFile            = %(DBPath)s/run@RunNumber@-refhit-db.slcio
PreAlignmentDBFile      = %(DBPath)s/run@RunNumber@-prealignment-db.slcio
AlignmentDBFile         = %(DBPath)s/reun@RunNumber@-alignment-db.slcio


[converter]
# section for the converter step
# MaxRecordNumber         = 100000
InputFile               = %(NativeFolder)s/run@RunNumber@.raw
OutputFile              = %(LcioPath)s/run@RunNumber@.slcio
HistoFile               = %(HistoPath)s/run@RunNumber@-converter
M26MaxFreq              = 0.005
M26MaxEvents            = 999
FEI4MaxFreq             = 0.005
FEI4MaxEvents           = 999

[clustering]
# MaxRecordNumber     = 100000
InputFile               = %(LcioPath)s/run@RunNumber@.slcio
OutputFile              = %(LcioPath)s/run@RunNumber@-clustering.slcio
HistoFile               = %(HistoPath)s/run@RunNumber@-clustering

[hitmaker]
InputFile		= %(LcioPath)s/run@RunNumber@-clustering.slcio
OutputFile              = %(LcioPath)s/run@RunNumber@-hits-global.slcio
HistoFile               = %(HistoPath)s/run@RunNumber@-hits-global
# MaxRecordNumber     = 100000

[align]
InputFile		= %(LcioPath)s/run@RunNumber@-hits-global.slcio
OutputFile   		= %(LcioPath)s/run@RunNumber@-alignment-PR.slcio
AlignmentDBFile         = %(DBPath)s/run@RunNumber@-align-linearPR-db.slcio
HistoFile               = %(HistoPath)s/run@RunNumber@-align-linearPR

PedeSteeringFile	= %(TemplatePath)s/pede-steer-tmp.txt
# do not need so many events for alignment - this overwrites global value set above
# MaxRecordNumber     = 100000
RunPede             = 1 
UseResidualCuts     = 1
Records             = 10000000
TrackCollectionName = daftrack
#                     plane0  1     2     20     21     3     4     5
ResidualXMin        = -1500. -1500. -500. -500. -500. -500. -1500. -1500.
ResidualXMax        =  1500.  1500.  500.  500.  500.  500.  1500.  1500.
ResidualYMin        = -1500. -1500. -500. -500. -500. -500. -1500. -1500.
ResidualYMax        =  1500.  1500.  500.  500.  500.  500.  1500.  1500.

ResolutionX         =  18.  18.  18.  50.  50.  18.  18.  18.
ResolutionY         =  18.  18.  18.  250.  250.  18.  18.  18.
ResolutionZ         =  1000.  1000.  1000.  1000.  1000.  1000.  1000.  1000.


#
# DistanceMax [um] used in EUTelMille/findTrack:
#
DistanceMax         =  1000 
#
ExcludePlanes       =  
FixedPlanes         = 0 5 
chi2max             	= 3000.  
chi2ndf			= 60.
method			= "inversion" 
methodmax		= 100
methodp			= 0.1
outlier			= 1

[fitter]
InputFile		= %(LcioPath)s/run@RunNumber@-hits-global.slcio
OutputFile              = %(LcioPath)s/run@RunNumber@-fitter.slcio 
# use default//defined above //AlignmentFile		= %(DBPath)s/run@RunNumber@-align-linearPR-db.slcio
# MaxRecordNumber     = 100000

#
# TestFitter options
AllowedSkipHits        = 0
SkipHitPenalty         = 0 
AllowedMissingHits     = 0
MissingHitPenalty      = 0 
Chi2Max                = 100
PassiveLayerIDs        = 
DistanceMax            = 1000.0


[trackTestFitter]
InputFile		= %(LcioPath)s/run@RunNumber@-hits-global.slcio
OutputFile              = %(LcioPath)s/run@RunNumber@-trackTestFitter.slcio

AlignmentDBFile         = %(DBPath)s/run@RunNumber@-align-linearPR-db.slcio
HistoFile               = %(HistoPath)s/run@RunNumber@-trackTestFitter

# TestFitter options
AllowedSkipHits		= 0
SkipHitPenalty		= 0 
AllowedMissingHits	= 0
MissingHitPenalty	= 0 
Chi2Max			= 30.0 # was 1000
PassiveLayerIDs		= 
SlopeDistanceMax	= 2000.0
DistanceMax	        = 0.1

# Section for alignment with DAFfitter
[aligndaf]
InputFile		= %(LcioPath)s/run@RunNumber@-hits-global.slcio
OutputFile   		= %(LcioPath)s/run@RunNumber@-alignment-daf.slcio
AlignmentDBFile         = %(DBPath)s/run@RunNumber@-align-daftracks-db.slcio
HistoFile               = %(HistoPath)s/run@RunNumber@-alignment-daf

PedeSteeringFile	= %(TemplatePath)s/pede-steer-tmp.txt
# Reduce events for alignment, overwriting global value set above
MaxRecordNumber		= 75000
# Run Millepede? 0 = false, 1 = true
RunPede			= 1
# Use residual cuts? 0 = false, 1 = true
UseResidualCuts		= 1
# The residual cuts in um per plane
#                     plane0  1     2     20     21     3     4     5
ResidualXMin        = -1500. -1500. -500. -500. -500. -500. -1500. -1500.
ResidualXMax        =  1500.  1500.  500.  500.  500.  500.  1500.  1500.
ResidualYMin        = -1500. -1500. -500. -500. -500. -500. -1500. -1500.
ResidualYMax        =  1500.  1500.  500.  500.  500.  500.  1500.  1500.

ResolutionX         =  18.  18.  18.  50.  50.  18.  18.  18.
ResolutionY         =  18.  18.  18.  250.  250.  18.  18.  18.
ResolutionZ         =  1000.  1000.  1000.  1000.  1000.  1000.  1000.  1000.

# Maximum distance in um for for matches used in EUTelMille/findTrack:
DistanceMax		= 2000
# Planes to exclude in alignment (not regarded at all)
ExcludePlanes		=
# Planes to consider as fixed in alignment (these planes are included in the
FixedParameter          = 0 0 0 0 0 0 0 0 
# alignment but with fixed positions)
FixedPlanes		= 0 5
TrackCollectionName     = daftracks



[trackdaf]

InputFile		= %(LcioPath)s/run@RunNumber@-hits-global.slcio

AlignmentDBFile         = %(DBPath)s/run@RunNumber@-align-daftracks-db.slcio
OutputFile              = %(LcioPath)s/run@RunNumber@-trackDafFitter.slcio
HistoFile               = %(HistoPath)s/run@RunNumber@-trackDafFitter

#

