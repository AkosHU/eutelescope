# =============================================================================
#
# examples/Run234_LAM_with_2FEI4
#
# =============================================================================
#
# Check the README for information
#
# =============================================================================
#
# Global section. Settings can be overwritten through task-specific sections
# The python config parser interprets '%(NAME)s' as the corresponding variable
# NAME. The variable 'eutelescopepath' is by default filled with the environment
# variable EUTELESCOPE and should correspond to the installation path of
# EUTelescope. Also, the variable '%(home)s' corresponds to the user's home
# directory. The template file name can be set with TemplateFile = file.xml. The
# default is '[task]-tmp.xml'
[DEFAULT]

# The path to this config file
BasePath		= /scratch/ilcsoft/v01-17-05/Eutelescope/master/jobsub/examples/GBL

# Set the folder which contains the raw/native data files
# You can find a data sample (see above) at
# /afs/desy.de/group/telescopes/EutelTestData/TestExampleDaturaNoDUT/FIXME
NativePath		= /scratch/ilcsoft/v01-17-05/Eutelescope/master/jobsub/examples/LAM/data

# The location of the steering templates
#TemplatePath		= %(BasePath)s/steering/steering_with_FEI4
TemplatePath		= %(BasePath)s/steering/

# The GEAR file describing the detector geometry, this is passed from the
# runlist.csv
GearFile    	        = @GearGeoFile@

# Path to the GEAR files
GearFilePath    	= %(BasePath)s/geometry


# The XML file with histogram information
HistoInfoFile   	= %(BasePath)s/steering/histoinfo.xml

# Formats the output; @RunNumber@ is the current run number padded with leading
# zeros to 6 digits
FilePrefix   	 	= run@RunNumber@	

# Which run number to use for hot pixel determination
HotpixelRunNumber	= @RunNumber@

# Skip events in a run; set to 0 for all data
SkipNEvents		= 0

# Output subfolder structure
DatabasePath		= %(BasePath)s/output/database
HistogramPath		= %(BasePath)s/output/histograms
LcioPath            	= %(BasePath)s/output/lcio
LogPath			= %(BasePath)s/output/logs

# Limit processing of a run to a certain number of events

# Limit processing of a run to a certain number of events
MaxRecordNumber		= 1000

# The verbosity used by the EUTelescope producers (i.e. MESSAGE, DEBUG, ERROR
# with appended level from 0..9, e.g. MESSAGE5). If you set this to DEBUG0 but
# you do not see any DEBUG messages, make sure that you set CMAKE_BUILD_TYPE to
# Debug in the $EUTELESCOPE/CMakeList.txt file.
Verbosity		= MESSAGE4


MemCheckFlag            = ""

# Section for the converter step
[converter]


# Section for the clustering step
[clustering]
ClusterLimits =   20 @xclumin@ @xclumax@ @yclumin@ @yclumax@    21 @xclumin@ @xclumax@ @yclumin@ @yclumax@


ResidualsXMax =   20.0  20.0  20.0   20.0  20.0   20.0  20.0  20.0           
ResidualsXMin =  -20.0 -20.0 -20.0  -20.0 -20.0  -20.0 -20.0 -20.0          
ResidualsYMax =   20.0  20.0  20.0   20.0  20.0   20.0  20.0  20.0           
ResidualsYMin =  -20.0 -20.0 -20.0  -20.0 -20.0  -20.0 -20.0 -20.0           


# Section for the filter step
[filter]

# Exclude 10 pixels in all directions
ROICut			= 10 10 1142 566


# Section for the hitmaker step
[hitmaker]

[hitlocal]
Verbosity		= MESSAGE5
# for run 1234: the first and last are FEI4
ResidualsXMax =  5.  5.  5.  5.  5.  5.  5.  5.
ResidualsXMin = -5. -5. -5. -5. -5. -5. -5. -5.
ResidualsYMax =  5.  5.  5.  5.  5.  5.  5.  5.
ResidualsYMin = -5. -5. -5. -5. -5. -5. -5. -5.




 

# Section for the old straightline alignment
[align]

# Reduce events for alignment, overwriting global value set above
MaxRecordNumber		= 200000

# Run Millepede? 0 = false, 1 = true
RunPede			= 1

# Use residual cuts? 0 = false, 1 = true
UseResidualCuts		= 1

# The residual cuts in um per plane

ResidualXMin		= -200. -200. -200. -200. -200. -200.
ResidualXMax		=  200.  200.  200.  200.  200.  200.
ResidualYMin		= -200. -200. -200. -200. -200. -200.
ResidualYMax		=  200.  200.  200.  200.  200.  200.

# Maximum distance in um for for matches used in EUTelMille/findTrack:
DistanceMax		= 2000

# Planes to exclude in alignment (not regarded at all)
ExcludePlanes		=

# Planes to consider as fixed in alignment (these planes are included in the
# alignment but with fixed positions)
FixedPlanes		= 0 5


# Section for alignment with DAFfitter
[aligndaf]
# Reduce events for alignment, overwriting global value set above
MaxRecordNumber		= 200000
# Run Millepede? 0 = false, 1 = true
RunPede			= 1
# Use residual cuts? 0 = false, 1 = true
UseResidualCuts		= 1
# The residual cuts in um per plane
ResidualXMin		= -1500. -1500. -1500. -1500. -1500. -1500.
ResidualXMax		=  1500.  1500.  1500.  1500.  1500.  1500.
ResidualYMin		= -1500. -1500. -1500. -1500. -1500. -1500.
ResidualYMax		=  1500.  1500.  1500.  1500.  1500.  1500.
# Maximum distance in um for for matches used in EUTelMille/findTrack:
DistanceMax		= 2000
# Planes to exclude in alignment (not regarded at all)
ExcludePlanes		=
# Planes to consider as fixed in alignment (these planes are included in the
# alignment but with fixed positions)
FixedPlanes		= 0 5
TrackCollectionName     = tracks

# Section for the fitter step
[fitter]

# TestFitter options
AllowedSkipHits		= 0
SkipHitPenalty		= 0 
AllowedMissingHits	= 0
MissingHitPenalty	= 0 
Chi2Max			= 30.0 # was 1000
PassiveLayerIDs		= 
SlopeDistanceMax	= 2000.0

[trackTestFitter]

# TestFitter options
AllowedSkipHits		= 0
SkipHitPenalty		= 0 
AllowedMissingHits	= 0
MissingHitPenalty	= 0 
Chi2Max			= 30.0 # was 1000
PassiveLayerIDs		= 
SlopeDistanceMax	= 2000.0
DistanceMax	        = 0.1

[trackdaf]

# Section for GBL track search - to become obsolete ?
[tracksearch]
ResidualsRMax =  2.0

# identical to previous - uses Exhaustive TrackSearch processor
[tracksearchExh]
ResidualsRMax =  2.0
# contains GBL tracking processor for alignment (disabled by deafult)
AlignmentMode		= 6
AlignPlaneIds		= 0 1 2 3 4 5
RunPede			= true
Chi2Cut			= 1000000
Planes                  = 0 1 2 3 4 5
rm26                     = 0.01
xResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s
yResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s



# track search processor developed for BField >0 , but includes BField=0 as subset.
[tracksearchHelix]
ResidualsRMax           = 10.0
# contains GBL tracking processor for alignment (disabled by deafult)
AlignmentMode		= 7
RunPede			= true
Chi2Cut			= 1000
rm26                    = 0.18
rfei4X                  = 2.50
rfei4Y                  = 0.50
#Planes                  = 0 1 2 3 4 5
#AlignPlaneIds		= 0 1 2 3 4 5
#xResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s  %(rm26)s %(rm26)s %(rm26)s
#yResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s
MaxMissingHitsPerTrack  = 0
AllowedSharedHitsOnTrackCandidate = 0
AlignPlaneIds		= 0 1 2 3 4 5
Planes                  = 0 1 2 3 4 5
xResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s  %(rm26)s %(rm26)s %(rm26)s
yResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s  %(rm26)s %(rm26)s %(rm26)s



# Section for GBL alignment
[aligngbl]

AllowedSharedHitsOnTrackCandidate=0

#default these number should be overwritten each time
r="1.25000";
xres="$r $r $r $r $r $r";
yres="$r $r $r $r $r $r";
GearAlignedFile=gear_default.xml


# correlator
ResidualsXMax =  5.  5.  5.  5.  5.  5.  5.  5.
ResidualsXMin = -5. -5. -5. -5. -5. -5. -5. -5.
ResidualsYMax =  5.  5.  5.  5.  5.  5.  5.  5.
ResidualsYMin = -5. -5. -5. -5. -5. -5. -5. -5.
pede          = 
# pattern recognition
MaxMissingHitsPerTrack  = 0
ResidualCut             = 1
ResidualsRMax           =  %(ResidualCut)s 
AlignmentMode		= 2
AlignPlaneIds		=  0 1 2  3 4 5 
RunPede			= true
Chi2Cut			= 1000
Planes                  =  0 1 2  3 4 5 
rm26                    = 0.18
rfei4X                  = 2.500
rfei4Y                  = 0.500
#xResolutionPlane        = %(rfei4X)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rfei4X)s 
#yResolutionPlane        = %(rfei4Y)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rfei4Y)s 
xResolutionPlane        =  %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s  
yResolutionPlane        =  %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s %(rm26)s  
#
FixXrot                 = 0 1 2 3 4 5 
FixXshifts              = 0  
FixYrot                 = 0 1 2 3 4 5 
FixYshifts              = 0 
FixZrot                 = 0 
FixZshifts              = 0 1 2 3 4 5 

#rm26                    = 0.18
#rfei4X                  = 2.500
#rfei4Y                  = 0.50
#xResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s %(rfei4X)s %(rm26)s %(rm26)s %(rm26)s
#yResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s %(rfei4Y)s %(rm26)s %(rm26)s %(rm26)s
#xResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s  %(rm26)s %(rm26)s %(rm26)s
#yResolutionPlane        = %(rm26)s %(rm26)s %(rm26)s  %(rm26)s %(rm26)s %(rm26)s

suffix                  = ""


# section for the output of telescope tracks into ROOT ntuple
# this can be used e.g. for DUT studies outside the EUTelescope framework using ROOT
[ntuple]
# TestFitter options
AllowedSkipHits		= 0
SkipHitPenalty		= 0 
AllowedMissingHits	= 0
MissingHitPenalty	= 0 
Chi2Max			= 30.0 # was 1000
PassiveLayerIDs		= 
SlopeDistanceMax	= 2000.0

[local-to-global]
